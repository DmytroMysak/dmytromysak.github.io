import{Q as B}from"./QCardActions-CLJaF5Bu.js";import{Q as x}from"./QCardSection-NG0FHRHY.js";import{Q as N}from"./QCard-C4N2OtfF.js";import{aP as P,bC as q,bD as z,b8 as S,I as C,L as M,U as I,aH as V,aI as R,V as L,N as D,J as g,aC as F,aJ as K,Y as U,Z as k,$ as A,Q as J,ag as h,a1 as d,a0 as u,aU as H,a4 as E,a5 as Q,br as Y,as as T,bx as Z,av as w,bm as G,aK as W,a7 as X,aj as $,b0 as ee}from"./index-CmuCMgBa.js";import{Q as ae}from"./QInput-Lm2QrpE2.js";import{Q as te}from"./QForm-BI170nwI.js";import{f as oe}from"./format-Dq9uPdyY.js";var _=(r=>(r.Text="text",r.Number="number",r))(_||{});function le(r){const a=t=>Array.isArray(t)?t.map(e=>a(e)):P(t)||q(t)||z(t)?a(S(t)):t&&typeof t=="object"?Object.keys(t).reduce((e,l)=>(e[l]=a(t[l]),e),{}):t;return a(r)}function re(r,a,t){const e=C(!1),l=C(!1),n=C(t.value),o=r,p=a;function b(s){const i=s&&typeof s=="object"?structuredClone(le(s)):S(s);return o.editTransform?.from?.(i)??i}function f(){l.value||(e.value=!1)}function c(){n.value=b(t.value),e.value=!0}function v(){return l.value||o.rules?.length&&o.rules?.some(s=>s(n.value)!==!0)?Promise.resolve():(l.value=!0,new Promise(s=>{const i=o.editTransform?.to?.(n.value)??n.value;p("onChange",i,()=>{l.value=!1,f(),s()})}))}function m(){M(()=>o.createMode,s=>{s?c():f()},{immediate:!0}),M(t,()=>{o.createMode&&c()},{immediate:!0})}return{isEditMode:e,isLoading:l,cancel:f,submit:v,enableEditMode:c,editedValue:n,mountEditableService:m}}const se=I({__name:"editableText",props:V({type:{default:_.Text},class:{default:""},placeholder:{default:"-"},label:{default:""},hint:{default:void 0},mask:{default:void 0},viewTransform:{type:Function,default:void 0},createMode:{type:Boolean,default:!1},rules:{default:void 0},editTransform:{default:void 0}},{modelValue:{required:!1,default:null},modelModifiers:{}}),emits:V(["onChange"],["update:modelValue"]),setup(r,{expose:a,emit:t}){const e=R(r,"modelValue"),l=r,n=t,{capitalize:o}=oe,{t:p}=L({useScope:"global"}),{cancel:b,enableEditMode:f,isEditMode:c,editedValue:v,submit:m,mountEditableService:s,isLoading:i}=re(l,n,e);a({submit:m}),D(()=>s());const O=g(()=>`${l.class} q-pa-sm`),j=g(()=>`${l.class} q-px-sm`),y={model:e,props:l,emit:n,capitalize:o,t:p,cancel:b,enableEditMode:f,isEditMode:c,editedValue:v,submit:m,mountEditableService:s,isLoading:i,textClasses:O,inputClasses:j,get ionCloseOutline(){return F},get ionCheckmarkOutline(){return K}};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}}),ne=$("span",{class:"q-focus-helper",tabindex:"-1"},null,-1);function ie(r,a,t,e,l,n){return k(),A(X,null,[e.isEditMode?T("",!0):J((k(),h(N,{key:0,flat:"",class:"cursor-pointer q-hoverable",onClick:a[0]||(a[0]=o=>e.enableEditMode())},{default:d(()=>[u(x,{horizontal:"",class:"flex justify-between"},{default:d(()=>[u(x,{class:H(e.textClasses)},{default:d(()=>[ne,E(" "+Q(e.props.viewTransform?.(e.model)||e.model||t.placeholder)+" ",1),u(B,{anchor:"top middle",offset:[14,30],delay:150},{default:d(()=>[E(Q(r.$t("editTooltip")),1)]),_:1})]),_:1},8,["class"]),Y(r.$slots,"favoriteButtons")]),_:3})]),_:3})),[[ee]]),e.isEditMode?(k(),h(te,{key:1,autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false",onSubmit:a[4]||(a[4]=G(o=>e.submit(),["prevent"])),onKeyup:a[5]||(a[5]=W(o=>e.cancel(),["esc"]))},{default:d(()=>[u(ae,{dense:"","no-error-icon":"",modelValue:e.editedValue,"onUpdate:modelValue":a[3]||(a[3]=o=>e.editedValue=o),"fill-mask":!!e.props.mask,mask:e.props.mask,loading:e.isLoading,type:e.props.type,label:e.props.label,"input-class":e.inputClasses,hint:e.props.hint?e.capitalize(e.t(e.props.hint)):void 0,rules:t.rules},Z({_:2},[e.props.createMode?void 0:{name:"append",fn:d(()=>[u(w,{flat:"",round:"",type:"submit",icon:e.ionCheckmarkOutline,onClick:a[1]||(a[1]=o=>e.submit()),color:"primary"},null,8,["icon"]),u(w,{flat:"",round:"",icon:e.ionCloseOutline,onClick:a[2]||(a[2]=o=>e.cancel())},null,8,["icon"])]),key:"0"}]),1032,["modelValue","fill-mask","mask","loading","type","label","input-class","hint","rules"])]),_:1})):T("",!0)],64)}const ve=U(se,[["render",ie],["__file","editableText.vue"]]);export{ve as E,re as a,_ as b};
