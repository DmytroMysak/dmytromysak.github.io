import{Q as b}from"./QCardSection-NG0FHRHY.js";import{Q as T}from"./QCard-C4N2OtfF.js";import{M as oe,d as se,Q as ie}from"./mealPlanner.service-B7CUl3Xz.js";import{Q as re}from"./QInnerLoading-86XDDgru.js";import{U,W as ce,V as Y,I as x,J as $,aX as de,Y as N,Z as u,$ as S,ag as w,a1 as l,a0 as a,a7 as I,ar as B,ah as Z,as as O,aj as h,a5 as i,a2 as P,a4 as g,av as q,a6 as F,ay as J,N as K,aY as me,aZ as ue,aA as fe,a_ as pe,a$ as ge,aU as _e,Q as ve,b0 as he,ai as ye,a3 as ke,b1 as xe}from"./index-CmuCMgBa.js";import{Q as Ce}from"./QPage-Blsos2c0.js";import{Q as A,F as E,a as Pe}from"./QCardActions-CLJaF5Bu.js";import{Q as we}from"./QImg-BWxTlY2N.js";import{a as X,c as Qe}from"./QSelect-B1fV5hfF.js";import{Q as be}from"./QExpansionItem-BRzWrkZm.js";import{f as G}from"./format-Dq9uPdyY.js";import{Q as qe}from"./QCheckbox-WeQmrjpL.js";import{Q as Me}from"./QSeparator-BZj1x5fP.js";import{Q as De}from"./QTable-8EEMW2-E.js";import{u as W,s as Se,S as Re}from"./searchFilter-B46quSSD.js";import{R as Oe}from"./recipe.service-B2BkU8jg.js";import{R as ze}from"./recipeItemActions-DR6360ev.js";import"./QInput-Lm2QrpE2.js";import"./uid-Bzmka5Fh.js";import"./debounce-Dh_zIq8Y.js";import"./is-BddHB8T5.js";import"./Lang-BaVfzyKw.js";import"./en-US-C0o87H2x.js";import"./use-prevent-scroll-5Ac-51KI.js";import"./History-BRlARYUr.js";import"./rtl-DFPa-2ov.js";import"./use-fullscreen-D4Edpx92.js";import"./folder.service-3sR9fq5W.js";import"./QForm-BI170nwI.js";import"./searchAutocomplete-DxeGRu9i.js";import"./QBtnDropdown-BGAbgpwa.js";import"./ClosePopup-Bnjv8jFB.js";import"./index-BkI8a_iM.js";const Ve=U({__name:"mealPlannerList",props:{mealPlanner:{}},emits:["onDelete"],setup(r,{expose:s,emit:_}){s();const e=r,f=_,{capitalize:y}=G,t=ce(),{t:n}=Y({useScope:"global"}),o=x(Object.fromEntries(e.mealPlanner?.recipes.map((c,d)=>[d,!1])??[])),k=$(()=>{const c=new Map;return e.mealPlanner?.recipes.forEach(d=>{if(c.has(d.id)){c.get(d.id).count++;return}c.set(d.id,{...d,count:1})}),[...c.values()]});function M(c){return t.push({name:"RecipeDetail",params:{id:c}})}const C={props:e,emit:f,capitalize:y,router:t,t:n,expanded:o,recipes:k,goToRecipeDetail:M,get ionTrashOutline(){return de}};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}}),Le={class:"text-subtitle1"},Ie={class:"text-caption"},Te={class:"row q-col-gutter-x-md q-col-gutter-y-md"},Be={class:"col-12"},Fe={key:1,class:"flex flex-center column"},Ae={class:"text-h5"};function Ue(r,s,_,e,f,y){return u(),S(I,null,[e.recipes?.length?(u(),w(b,{key:0,class:"q-pa-none"},{default:l(()=>[a(Z,{class:"row"},{default:l(()=>[(u(!0),S(I,null,B(e.recipes,(t,n)=>(u(),w(be,{key:n,modelValue:e.expanded[n],"onUpdate:modelValue":o=>e.expanded[n]=o,icon:"perm_identity","switch-toggle-side":"","expand-icon-toggle":"",dense:"",class:"col-12"},{header:l(()=>[a(P,null,{default:l(()=>[h("span",Le,[g(i(e.capitalize(t.name))+" ",1),a(A,{anchor:"top middle",offset:[14,30],delay:150},{default:l(()=>[g(i(e.capitalize(t.name)),1)]),_:2},1024)]),h("span",Ie,i(e.capitalize(t.category||"")),1)]),_:2},1024),a(P,{side:""},{default:l(()=>[g(" ( "+i(t.count)+" ) ",1)]),_:2},1024),a(P,{side:""},{default:l(()=>[a(q,{icon:e.ionTrashOutline,onClick:o=>e.emit("onDelete",t),round:"",flat:"",color:"secondary"},null,8,["icon","onClick"])]),_:2},1024)]),default:l(()=>[a(T,null,{default:l(()=>[a(we,{src:t.imageUrl,loading:"lazy",height:"150px"},null,8,["src"]),a(b,null,{default:l(()=>[(u(!0),S(I,null,B(t.ingredients,(o,k)=>(u(),w(F,{key:k},{default:l(()=>[a(P,{class:"ellipsis"},{default:l(()=>[a(X,null,{default:l(()=>[g(i(`${o?.name} - ${o?.number} ${e.t(`ingredients.type.${o?.type}`)}`)+" ",1),a(A,{anchor:"top middle",offset:[14,30],delay:150},{default:l(()=>[g(i(`${o?.name} - ${o?.number} ${e.t(`ingredients.type.${o?.type}`)}`),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),h("div",Te,[h("div",Be,[a(q,{class:"q-mt-lg full-width",onClick:o=>e.goToRecipeDetail(t.id),color:"secondary"},{default:l(()=>[g(i(r.$t("mealPlanner.clickForMore")),1)]),_:2},1032,["onClick"])])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"]))),128))]),_:1})]),_:1})):O("",!0),e.recipes?.length?O("",!0):(u(),S("div",Fe,[h("div",Ae,i(r.$t("mealPlanner.emptyListMessage")),1)]))],64)}const Ye=N(Ve,[["render",Ue],["__file","mealPlannerList.vue"]]),Ne=U({__name:"mealPlannerChange",props:{recipes:{default:[]},title:{}},emits:W.emits,setup(r,{expose:s}){s();const _=r,{capitalize:e}=G,{dialogRef:f,onDialogOK:y,onDialogCancel:t}=W(),{filter:n,search:o,pageSize:k}=Se(E.MealPlanner),{t:M}=Y({useScope:"global"}),C=J(),{getRecipes:c}=Oe(),d=x(!1),z=x(),Q=x([]),R=x([]),m=x({page:1,rowsPerPage:k.value,rowsNumber:0}),H=$(()=>C.dark.isActive?"bg-grey-9":"bg-grey-2");async function ee(p){const{page:v,rowsPerPage:D}=p?.pagination??m.value;d.value=!0;const V=await c({search:o.value,page:v,pageSize:D,filter:n.value});m.value.rowsNumber=V.totalFiltered,R.value=V.items.map(L=>{const le=Q.value.find(ne=>ne.id===L.id)?.count??1;return{...L,count:le}}),k.value=D,m.value.page=v,m.value.rowsPerPage=D,d.value=!1}function ae(){const p=Q.value.flatMap(v=>Array(v.count).fill(v.id));y(p)}function te(p,v){const D=Math.max(0,p.count+v),V=Q.value.find(L=>L.id===p.id)??p;V.count=D,p.count=D}K(()=>{if(_.recipes){const p=new Map;_.recipes.forEach(v=>{if(p.has(v.id)){p.get(v.id).count++;return}p.set(v.id,{...v,count:1})}),Q.value=[...p.values()]}setTimeout(()=>z?.value.requestServerInteraction())});const j={props:_,capitalize:e,dialogRef:f,onDialogOK:y,onDialogCancel:t,filter:n,search:o,pageSize:k,t:M,$q:C,getRecipes:c,isLoading:d,tableRef:z,selected:Q,rows:R,pagination:m,selectedClass:H,onRequest:ee,change:ae,changeCount:te,get FilterType(){return E},get ionBookmarkOutline(){return me},get ionBookmark(){return ue},get ionAddOutline(){return fe},get ionRemoveOutline(){return pe},SearchFilter:Re,RecipeItemActions:ze};return Object.defineProperty(j,"__isScriptSetup",{enumerable:!1,value:!0}),j}}),je={key:0,class:"flex items-center q-pt-sm"},Ee={class:"q-px-sm text-subtitle1"};function We(r,s,_,e,f,y){return u(),w(Qe,{ref:"dialogRef",persistent:"",maximized:""},{default:l(()=>[a(T,{class:"q-dialog-plugin",style:{"max-width":"1024px","max-height":"90%"}},{default:l(()=>[a(b,{class:"text-h5"},{default:l(()=>[g(i(e.capitalize(r.$t("mealPlanner.change",{item:e.props.title}))),1)]),_:1}),a(b,{class:"col-12 scroll",style:{"max-height":"70vh"}},{default:l(()=>[a(e.SearchFilter,{onOnChange:e.onRequest,"filter-key":e.FilterType.MealPlanner,"hide-sort-by":!0},null,8,["filter-key"]),a(De,{ref:"tableRef",rows:e.rows,"row-key":"id",selection:"multiple",pagination:e.pagination,"onUpdate:pagination":s[0]||(s[0]=t=>e.pagination=t),selected:e.selected,"onUpdate:selected":s[1]||(s[1]=t=>e.selected=t),filter:e.search,loading:e.isLoading,"rows-per-page-options":[10,20,50,100],onRequest:e.onRequest,grid:"","hide-header":""},{item:l(t=>[h("div",{class:"q-pa-xs col col-xs-12 col-sm-6 col-md-4 col-lg-4 col-xl-4 grid-style-transition",style:ge(t.selected?"transform: scale(0.95);":"")},[a(T,{bordered:"",class:_e(t.selected?e.selectedClass:"")},{default:l(()=>[a(b,{class:"bg-positive text-black"},{default:l(()=>[a(F,{dense:"",class:"q-px-none"},{default:l(()=>[a(P,{thumbnail:"",class:"q-pr-none"},{default:l(()=>[a(qe,{modelValue:t.selected,"onUpdate:modelValue":n=>t.selected=n,"toggle-indeterminate":!1,size:"lg",dark:!1},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(P,{class:"text-subtitle1 text-bold text-black"},{default:l(()=>[a(X,null,{default:l(()=>[g(i(t.row.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t.selected?(u(),S("div",je,[a(q,{round:"",color:"primary",icon:e.ionRemoveOutline,size:"xs",outline:"",onClick:n=>e.changeCount(t.row,-1)},null,8,["icon","onClick"]),h("span",Ee,i(t.row.count),1),a(q,{round:"",color:"primary",icon:e.ionAddOutline,size:"xs",outline:"",onClick:n=>e.changeCount(t.row,1)},null,8,["icon","onClick"])])):O("",!0)]),_:2},1024),a(Me,{color:"primary"}),t.row?.ingredients?(u(),w(Z,{key:0,dense:""},{default:l(()=>[(u(!0),S(I,null,B(t.row?.ingredients,n=>ve((u(),w(F,{key:n.id},{default:l(()=>[a(P,{class:"ellipsis"},{default:l(()=>[g(i(n?.name),1)]),_:2},1024),a(P,{side:""},{default:l(()=>[g(i(`${n?.number} ${e.t(`ingredients.type.${n?.type}`)}`),1)]),_:2},1024)]),_:2},1024)),[[he]])),128))]),_:2},1024)):O("",!0),a(b,{class:"flex q-px-sm"},{default:l(()=>[a(e.RecipeItemActions,{item:t.row},null,8,["item"]),a(ye),a(ke,{name:t.row?.favorite?e.ionBookmark:e.ionBookmarkOutline,size:"md",color:"secondary"},{default:l(()=>[a(A,{anchor:"top middle",offset:[14,30],delay:150,class:"text-capitalize"},{default:l(()=>[g(i(r.$t("favorite.name")),1)]),_:1})]),_:2},1032,["name"])]),_:2},1024)]),_:2},1032,["class"])],4)]),_:1},8,["rows","pagination","selected","filter","loading"])]),_:1}),a(Pe,{align:"right",class:"q-pa-md"},{default:l(()=>[a(q,{color:"primary",label:r.$t("cancel"),onClick:e.onDialogCancel},null,8,["label","onClick"]),a(q,{color:"primary",label:r.$t("change"),disable:!e.selected.length,onClick:e.change},null,8,["label","disable"])]),_:1})]),_:1})]),_:1},512)}const $e=N(Ne,[["render",We],["__file","mealPlannerChange.vue"]]),Ze=U({__name:"mealPlannerPage",setup(r,{expose:s}){s();const{formatDate:_}=se,e=x(!1),f=x(void 0),y=x([]),t=J(),{t:n}=Y({useScope:"global"}),{getMealPlanner:o,changeMealPlanner:k,getActiveDates:M,removeFromMealPlanner:C}=oe(),c=x(_(new Date,"YYYY/MM/DD"));function d(){e.value=!0,M().then(m=>{y.value=m}),o(c.value).then(m=>{f.value=m?.[0]}).finally(()=>{e.value=!1})}function z(){t.dialog({component:$e,componentProps:{recipes:f.value?.recipes,title:_(c.value,"DD MMM YYYY (dddd)")}}).onOk(async m=>{f.value=await k(c.value,m)})}function Q(m){e.value||t.dialog({title:xe(n("delete")),message:n("deleteConfirmation",{item:m.name}),cancel:!0,persistent:!0}).onOk(async()=>{f.value&&(await C(f.value.id,m.id),d())})}K(()=>d());const R={formatDate:_,isLoading:e,mealPlanner:f,events:y,$q:t,t:n,getMealPlanner:o,changeMealPlanner:k,getActiveDates:M,removeFromMealPlanner:C,selectedDate:c,loadMealPlanner:d,toggleChangeMealPlanner:z,deleteMealPlanner:Q,MealPlannerList:Ye};return Object.defineProperty(R,"__isScriptSetup",{enumerable:!1,value:!0}),R}}),Je={class:"row q-col-gutter-x-md q-col-gutter-y-md"},Ke={class:"col"},Xe={class:"row q-col-gutter-x-md q-col-gutter-y-md"},Ge={class:"col col-xs-12 col-sm-12 col-md-5 col-lg-4 col-xl-4 flex justify-center items-start"},He={class:"col col-xs-12 col-sm-12 col-md-8 col-lg-5 col-xl-5 column"};function ea(r,s,_,e,f,y){return u(),w(Ce,{class:"q-pa-md q-col-gutter-x-md q-col-gutter-y-md"},{default:l(()=>[h("div",Je,[h("div",Ke,[a(T,{class:"q-pa-sm"},{default:l(()=>[a(b,{horizontal:"",class:"text-h5 text-capitalize ellipsis"},{default:l(()=>[g(i(r.$t("mealPlanner.name")),1)]),_:1})]),_:1})])]),h("div",Xe,[h("div",Ge,[a(ie,{modelValue:e.selectedDate,"onUpdate:modelValue":[s[0]||(s[0]=t=>e.selectedDate=t),e.loadMealPlanner],events:e.events,"today-btn":"","event-color":"accent","text-color":"black",color:"positive"},null,8,["modelValue","events"])]),h("div",He,[e.isLoading?O("",!0):(u(),w(e.MealPlannerList,{key:0,"meal-planner":e.mealPlanner,onOnDelete:e.deleteMealPlanner},null,8,["meal-planner"])),a(re,{showing:e.isLoading},null,8,["showing"]),a(q,{class:"q-mt-lg self-center",onClick:s[1]||(s[1]=t=>e.toggleChangeMealPlanner()),color:"secondary"},{default:l(()=>[g(i(r.$t("mealPlanner.change")),1)]),_:1})])])]),_:1})}const Va=N(Ze,[["render",ea],["__file","mealPlannerPage.vue"]]);export{Va as default};
