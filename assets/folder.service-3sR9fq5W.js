import{aV as A,aW as S,aD as c}from"./index-CmuCMgBa.js";import{g as p}from"./QCardActions-CLJaF5Bu.js";import{R as T}from"./recipe.service-B2BkU8jg.js";const Z=[{id:"1",name:"Меню 3",favorite:!1,type:"recipe",imageUrl:"/folder.jpg",createdAt:"2024-03-20T07:49:22.417Z",updatedAt:"2024-03-20T07:49:22.417Z"},{id:"2",name:"Меню 4",favorite:!1,type:"recipe",imageUrl:"/folder.jpg",createdAt:"2024-03-20T07:49:22.417Z",updatedAt:"2024-03-20T07:49:22.417Z"},{name:"Меню 5",type:"recipe",imageUrl:"/folder.jpg",id:"7be09d23-4c52-4f17-b4d5-528080fd141b",favorite:!1,createdAt:"2024-03-20T07:55:12.021Z",updatedAt:"2024-03-20T07:55:12.021Z"},{name:"Меню 6",type:"recipe",imageUrl:"/folder.jpg",id:"fe29c05f-dd85-4495-804c-9d72343f7021",favorite:!1,createdAt:"2024-04-20T11:03:07.171Z",updatedAt:"2024-04-20T11:03:07.171Z"}],j=A(()=>{const{updateRecipeFolders:m,getRecipes:u}=T();[1].forEach(e=>localStorage.removeItem(`folders-v${e}`));const r=S("folders-v2",Z);async function n(e){const{items:t}=await u({filter:[{key:"folders",type:"MultiString",data:[e.id]}],pageSize:1e4});return{...e,items:t}}function f(e){return Promise.all(e.map(t=>n(t)))}const v=async e=>{await c();const{items:t,name:o,type:a,imageUrl:d}=e,s=new Date().toISOString(),i={name:o,type:a,imageUrl:d,id:crypto.randomUUID(),favorite:!1,createdAt:s,updatedAt:s};return r.value.push(i),await Promise.all(t?.map(w=>m(w.id,[i.id],"add"))),n(i)},g=async(e={})=>{await c();const{items:t,totalFiltered:o}=p(r.value,e);return{totalFiltered:o,items:await f(t)}};async function y({search:e}={}){return e?r.value.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())).map(t=>({label:t.name,value:t.id})).slice(0,10):r.value.map(t=>({label:t.name,value:t.id})).slice(0,10)}const F=async e=>{r.value=r.value.filter(t=>t.id!==e)},l=async(e,t={})=>{const o=r.value.find(d=>d.id===e);if(!o)return;const a=await n(o);return{...a,...p(a.items,t)}};return{creteFolder:v,getFolders:g,removeFolder:F,getFolderById:l,editFolder:async(e,t)=>{await c();const o=await l(e);return r.value=r.value.map(a=>{if(a.id!==e)return a;const d=new Date().toISOString(),s=(t.items||o?.items)?.map(i=>i?.id??i);return a.id===e?JSON.parse(JSON.stringify({...a,...t,items:s,updatedAt:d})):a}),l(e)},folderAutocomplete:y}});export{j as F};
