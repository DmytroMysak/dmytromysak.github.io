import{D as X,S as re,b as Q,c as de,d as me,a as fe,Q as K}from"./QCardActions-CLJaF5Bu.js";import{X as pe,W as ye,bk as _e,L as ge,aM as he,aQ as ee,M as be,V as J,bl as Se,B as ke,I as Fe,U as Y,Y as W,Z as f,ag as k,a1 as r,a0 as a,a4 as v,a5 as S,bm as ve,$ as C,a7 as D,ar as U,as as V,aj as O,ah as ne,Q as L,a6 as P,a2 as B,b0 as te,av as N,bn as oe,bo as le,J as E,a3 as T,ay as Ce,bp as Ve,bq as Oe,aC as Qe,br as Be,ai as qe}from"./index-CmuCMgBa.js";import{Q as se}from"./QInput-Lm2QrpE2.js";import{Q as x}from"./QCardSection-NG0FHRHY.js";import{A as Ae,Q as ie,a as $,c as xe}from"./QSelect-B1fV5hfF.js";import{Q as ce}from"./QCard-C4N2OtfF.js";import{f as Z}from"./format-Dq9uPdyY.js";import{F as De}from"./folder.service-3sR9fq5W.js";import{Q as ae}from"./QCheckbox-WeQmrjpL.js";import{Q as we}from"./QForm-BI170nwI.js";import{S as ze}from"./searchAutocomplete-DxeGRu9i.js";import{Q as Re}from"./QBtnDropdown-BGAbgpwa.js";import{C as Ne}from"./ClosePopup-Bnjv8jFB.js";const I=new WeakMap;function A(o,c,i={}){const{mode:e="replace",route:n=pe(),router:m=ye(),transform:t=_=>_}=i;I.has(m)||I.set(m,new Map);const l=I.get(m);let u=n.query[o];he(()=>{u=void 0});let h;const b=_e((_,F)=>(h=F,{get(){return _(),t(u!==void 0?u:ee(c))},set(d){u!==d&&(u=d===c||d===null?void 0:d,l.set(o,d===c||d===null?void 0:d),F(),be(()=>{if(l.size===0)return;const s=Object.fromEntries(l.entries());l.clear();const{params:p,query:y,hash:g}=n;m[ee(e)]({params:p,query:{...y,...s},hash:g})}))}}));return ge(()=>n.query[o],_=>{u=_,h()},{flush:"sync"}),b}function Ue(o){return!(typeof o!="object"||!o||!("key"in o)||!("type"in o)||!("data"in o)||!["MultiString","String","Boolean","Number"].includes(o.type)||!Array.isArray(o.data))}function Te(o){if(!o)return[];try{return(Array.isArray(o)?o.map(i=>typeof i=="string"?JSON.parse(i):i):[JSON.parse(o)]).filter(Ue)}catch{return[]}}function Me(o){return function(i){if(!i)return X;const[e,n]=i?.split("@")??[],m=(re[o]??[]).includes(e),t=[Q.Asc,Q.Desc].includes(n),[l,u]=X.split("@");return`${m?e:l}@${t?n:u}`}}const G=o=>{const{t:c}=J({useScope:"global"}),{getAutocomplete:i}=Ae(),{folderAutocomplete:e}=De(),n=A("filter","",{transform:Te}),m=A("search",""),t=A("page","1",{transform:Number}),l=A("pageSize",de,{transform:Number}),u=A("sortBy","",{transform:Me(o)});function h(d,s){n.value=n.value.map(({data:p,key:y,type:g})=>{const w={data:p,key:y,type:g,toString(){return JSON.stringify({data:this.data,key:this.key,type:this.type})}};return y===d.key&&(w.data=p.filter((z,R)=>R!==s)),w}).filter(p=>p.data.length)}function b(d,s){return d.type==="Boolean"?c(s?"yes":"no"):(s?.label??s).toString()}function _(){const d=me[o],s=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});d.sort((y,g)=>s.compare(y.key,g.key));const p=d.map(y=>{const{key:g,data:w,type:z}=y,R=n.value.find(q=>q.key===g)?.data??w;let j=["Number","String"].includes(z)?R?.[0]:R;z==="Boolean"&&(j=j.map(q=>q?"yes":"no"));let H=["ingredients","category","complexity"].includes(g)?q=>i(g,q):void 0;return g==="folders"&&(H=e),{model:j,key:g,type:z,getOptions:H,label:`filters.items.${y.key}`}});return Se(p)}function F(d){n.value=d.filter(s=>Array.isArray(s.model)?!!s.model.length:!!s.model).map(s=>{let p=Array.isArray(s.model)?s.model:[s.model];return s.type==="Boolean"&&(p=p.map(y=>y==="yes")),{data:p,key:s.key,type:s.type,toString(){return JSON.stringify({data:this.data,key:this.key,type:this.type})}}})}return{filter:n,search:m,removeFilterValue:h,formatFilterValue:b,getFormFromFilter:_,setNewFilterFromForm:F,page:t,pageSize:l,sortBy:u}},je=()=>!0;function Ee(o){const c={};return o.forEach(i=>{c[i]=je}),c}function M(){const{emit:o,proxy:c}=ke(),i=Fe(null);function e(){i.value.show()}function n(){i.value.hide()}function m(l){o("ok",l),n()}function t(){o("hide")}return Object.assign(c,{show:e,hide:n}),{dialogRef:i,onDialogHide:t,onDialogOK:m,onDialogCancel:n}}const ue=["ok","hide"];M.emits=ue;M.emitsObject=Ee(ue);const Ie=Y({__name:"filterModal",props:{filterKey:{}},emits:M.emits,setup(o,{expose:c}){c();const i=o,{capitalize:e}=Z,{t:n}=J({useScope:"global"}),{dialogRef:m,onDialogOK:t,onDialogCancel:l}=M(),{getFormFromFilter:u,setNewFilterFromForm:h}=G(i.filterKey),b=u();function _(){b.forEach(s=>{s.model=["Number","String"].includes(s.type)?"":[]})}function F(){h(b),t()}const d={props:i,capitalize:e,t:n,dialogRef:m,onDialogOK:t,onDialogCancel:l,getFormFromFilter:u,setNewFilterFromForm:h,form:b,resetForm:_,onSubmit:F,SearchAutocomplete:ze};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}}),Ke={class:"text-h6 text-capitalize q-item__label--header q-pl-none q-pb-none"};function Le(o,c,i,e,n,m){return f(),k(xe,{ref:"dialogRef",position:"right","full-height":"",maximized:""},{default:r(()=>[a(ce,{class:"q-dialog-plugin column justify-between"},{default:r(()=>[a(x,{class:"q-px-none scroll",style:{"max-height":"85vh"}},{default:r(()=>[a(x,{class:"text-h5 text-capitalize"},{default:r(()=>[v(S(o.$t("filter")),1)]),_:1}),a(x,null,{default:r(()=>[a(we,{onSubmit:ve(e.onSubmit,["prevent"]),onReset:e.resetForm},{default:r(()=>[(f(!0),C(D,null,U(e.form,t=>(f(),C("div",{key:t.key,class:"q-pb-md"},[t.type==="String"?(f(),k(e.SearchAutocomplete,{key:0,label:t.label,"get-list":t.getOptions,modelValue:t.model,"onUpdate:modelValue":l=>t.model=l},null,8,["label","get-list","modelValue","onUpdate:modelValue"])):V("",!0),t.type==="MultiString"?(f(),k(e.SearchAutocomplete,{key:1,label:t.label,multiple:!0,"get-list":t.getOptions,modelValue:t.model,"onUpdate:modelValue":l=>t.model=l},{"selected-item":r(l=>[a(ie,{class:"ellipsis",removable:"",dense:"",color:"secondary",onRemove:u=>l.removeAtIndex(l.index),tabindex:l.tabindex},{default:r(()=>[v(S(l.opt?.label??l.opt),1)]),_:2},1032,["onRemove","tabindex"])]),_:2},1032,["label","get-list","modelValue","onUpdate:modelValue"])):V("",!0),t.type==="Number"?(f(),k(se,{key:2,type:"number",filled:"",label:e.capitalize(e.t(t.label)),modelValue:t.model,"onUpdate:modelValue":l=>t.model=l},null,8,["label","modelValue","onUpdate:modelValue"])):V("",!0),t.type==="Boolean"?(f(),C(D,{key:3},[O("div",Ke,S(e.capitalize(e.t(t.label))),1),a(ne,null,{default:r(()=>[L((f(),k(P,{tag:"label",class:"q-pl-none"},{default:r(()=>[a(B,{avatar:""},{default:r(()=>[a(ae,{modelValue:t.model,"onUpdate:modelValue":l=>t.model=l,val:"yes",color:"primary"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(B,null,{default:r(()=>[a($,null,{default:r(()=>[v(S(o.$t("yes")),1)]),_:1})]),_:1})]),_:2},1024)),[[te]]),L((f(),k(P,{tag:"label",class:"q-pl-none"},{default:r(()=>[a(B,{avatar:""},{default:r(()=>[a(ae,{modelValue:t.model,"onUpdate:modelValue":l=>t.model=l,val:"no",color:"primary"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(B,null,{default:r(()=>[a($,null,{default:r(()=>[v(S(o.$t("no")),1)]),_:1})]),_:1})]),_:2},1024)),[[te]])]),_:2},1024)],64)):V("",!0)]))),128))]),_:1})]),_:1})]),_:1}),a(fe,{align:"right",class:"q-pa-md"},{default:r(()=>[a(N,{label:o.$t("filters.reset"),onClick:e.resetForm},null,8,["label"]),a(N,{label:o.$t("cancel"),onClick:e.onDialogCancel},null,8,["label","onClick"]),a(N,{color:"primary",label:o.$t("add"),type:"submit",onClick:e.onSubmit},null,8,["label"])]),_:1})]),_:1})]),_:1},512)}const Pe=W(Ie,[["render",Le],["__file","filterModal.vue"]]),$e=Y({__name:"sortBy",props:{filterKey:{}},emits:["onChange"],setup(o,{expose:c,emit:i}){c();const e=o,n=i,{capitalize:m}=Z,{sortBy:t,page:l}=G(e.filterKey),u={[Q.Desc]:oe,[Q.Asc]:le},h=(re[e.filterKey]??[]).flatMap(y=>[{title:y,icon:oe,sort:Q.Desc},{title:y,icon:le,sort:Q.Asc}]),{t:b}=J({useScope:"global"}),_=E(()=>m(b(`sortBy.${t.value?.split("@")[1]}`))),F=E(()=>u[t.value?.split("@")[1]]),d=E(()=>m(b(`sortBy.${t.value?.split("@")[0]}`)));function s(y,g){t.value=`${y}@${g}`,l.value=1,n("onChange")}const p={props:e,emit:n,capitalize:m,sortBy:t,page:l,icons:u,list:h,t:b,selectedSort:_,selectedIcon:F,selectedTitle:d,emitSort:s};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}}),Je={class:"row items-center no-wrap"},Ye={class:"text-center gt-sm q-pl-xs text-primary"};function We(o,c,i,e,n,m){return f(),k(Re,{"fab-mini":"",flat:""},{label:r(()=>[O("div",Je,[a(T,{left:"",name:e.selectedIcon,color:"primary"},null,8,["name"]),O("div",Ye,S(e.selectedTitle),1),a(K,{anchor:"top middle",offset:[14,30],delay:50},{default:r(()=>[v(S(e.selectedSort),1)]),_:1})])]),default:r(()=>[a(ne,null,{default:r(()=>[(f(!0),C(D,null,U(e.list,(t,l)=>L((f(),k(P,{clickable:"",key:l,onClick:u=>e.emitSort(t.title,t.sort)},{default:r(()=>[a(B,null,{default:r(()=>[a($,null,{default:r(()=>[v(S(e.capitalize(e.t(`sortBy.${t.title}`))),1)]),_:2},1024)]),_:2},1024),a(B,{side:""},{default:r(()=>[a(T,{name:t.icon},null,8,["name"]),a(K,{anchor:"top middle",offset:[14,30],delay:50},{default:r(()=>[v(S(e.capitalize(e.t(`sortBy.${t.sort}`))),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[Ne]])),128))]),_:1})]),_:1})}const Ze=W($e,[["render",We],["__file","sortBy.vue"]]),Ge=Y({__name:"searchFilter",props:{filterKey:{},hideSortBy:{type:Boolean}},emits:["onChange"],setup(o,{expose:c,emit:i}){c();const e=o,n=i,{capitalize:m}=Z,t=Ce(),{filter:l,search:u,removeFilterValue:h,formatFilterValue:b}=G(e.filterKey);function _(){setTimeout(()=>n("onChange"))}function F(){t.dialog({component:Pe,componentProps:{filterKey:e.filterKey}}).onOk(()=>_())}function d(y,g){h(y,g),_()}function s(){u.value="",_()}const p={props:e,emit:n,capitalize:m,$q:t,filter:l,search:u,removeFilterValue:h,formatFilterValue:b,emitFilter:_,openFilterModal:F,removeFilter:d,clearSearch:s,get ionFunnelOutline(){return Ve},get ionSearchOutline(){return Oe},get ionCloseOutline(){return Qe},SortBy:Ze};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}}),He={class:"row q-col-gutter-x-md q-col-gutter-y-md"},Xe={class:"col"},et={class:"gt-sm q-pl-xs"},tt={class:"q-pr-md"};function ot(o,c,i,e,n,m){return f(),C("div",He,[O("div",Xe,[a(ce,{class:"q-pa-sm"},{default:r(()=>[a(x,{horizontal:""},{default:r(()=>[a(N,{color:"accent",class:"text-capitalize q-mr-sm",outline:"",icon:e.ionFunnelOutline,onClick:e.openFilterModal},{default:r(()=>[O("span",et,S(o.$t("filter")),1),a(K,{anchor:"top middle",offset:[14,30],delay:150,class:"text-capitalize"},{default:r(()=>[v(S(o.$t("filter")),1)]),_:1})]),_:1},8,["icon"]),Be(o.$slots,"additionalButtons"),a(qe),e.props.hideSortBy?V("",!0):(f(),k(e.SortBy,{key:0,"filter-key":e.props.filterKey,onOnChange:e.emitFilter},null,8,["filter-key"])),a(se,{dense:"",outlined:"",modelValue:e.search,"onUpdate:modelValue":[c[0]||(c[0]=t=>e.search=t),e.emitFilter],label:o.$t("search"),debounce:"350",class:"q-pl-sm",color:"secondary"},{append:r(()=>[e.search?(f(),k(T,{key:0,name:e.ionCloseOutline,onClick:e.clearSearch,class:"cursor-pointer"},null,8,["name"])):V("",!0),a(T,{name:e.ionSearchOutline},null,8,["name"])]),_:1},8,["modelValue","label"])]),_:3}),e.filter.length?(f(),k(x,{key:0,class:"q-mt-sm q-pa-none"},{default:r(()=>[(f(!0),C(D,null,U(e.filter,t=>(f(),C("span",{key:t.key},[O("span",null,S(e.capitalize(o.$t(`filters.items.${t.key}`)))+": ",1),O("span",tt,[(f(!0),C(D,null,U(t.data,(l,u)=>(f(),k(ie,{key:u,removable:"",onRemove:h=>e.removeFilter(t,u),color:"secondary","text-color":"white",outline:""},{default:r(()=>[v(S(e.formatFilterValue(t,l)),1)]),_:2},1032,["onRemove"]))),128))])]))),128))]),_:1})):V("",!0)]),_:3})])])}const _t=W(Ge,[["render",ot],["__file","searchFilter.vue"]]);export{_t as S,G as s,M as u};
